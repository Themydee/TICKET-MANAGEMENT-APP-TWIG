{% extends "layout.twig" %}

{% block title %}Dashboard - TicketFlow{% endblock %}

{% block content %}
<div style="min-height: 100vh; display: flex; flex-direction: column">
  <!-- Header -->
  <header class="header">
    <div class="container header-content">
      <div class="logo">TicketFlow</div>
      <nav class="nav-links">
        <div style="display: flex; align-items: center; gap: 1rem">
          <span style="color: #6b7280">
            Welcome, <strong id="username"></strong>
          </span>
          <button class="btn btn-secondary" onclick="logout()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            Logout
          </button>
        </div>
      </nav>
    </div>
  </header>

  <!-- Main content -->
  <div class="dashboard">
    <div class="container">
      <!-- Dashboard header -->
      <div class="dashboard-header">
        <h1>Dashboard</h1>
        <!-- âœ… FIXED: Changed from /index.php?page=tickets to ?page=tickets -->
        <a href="?page=tickets" class="btn btn-primary">
          Manage Tickets
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      </div>

      <!-- Statistics cards -->
      <div class="stats-grid">
        <div class="stat-card">
          <h3 id="total-tickets">0</h3>
          <p>Total Tickets</p>
        </div>

        <div class="stat-card">
          <h3 id="open-tickets" style="color: #10b981">0</h3>
          <p>Open Tickets</p>
        </div>

        <div class="stat-card">
          <h3 id="inprogress-tickets" style="color: #f59e0b">0</h3>
          <p>In Progress</p>
        </div>

        <div class="stat-card">
          <h3 id="closed-tickets" style="color: #6b7280">0</h3>
          <p>Closed Tickets</p>
        </div>
      </div>

      <!-- Quick actions -->
      <div style="background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 2rem">
        <h2 style="margin-bottom: 1rem">Quick Actions</h2>
        <p style="color: #6b7280; margin-bottom: 1.5rem">
          Get started by managing your tickets or viewing detailed statistics.
        </p>

        <div style="display: flex; gap: 1rem; flex-wrap: wrap">
          <!-- âœ… FIXED: Changed both links -->
          <a href="?page=tickets" class="btn btn-primary">View All Tickets</a>
          <a href="?page=tickets" class="btn btn-secondary">Create New Ticket</a>
        </div>
      </div>

      <!-- Welcome message -->
      <div id="welcome-message" class="hidden"
        style="background: #eff6ff; padding: 2rem; border-radius: 1rem; margin-top: 2rem; text-align: center; border: 2px dashed #93c5fd">
        <h3 style="color: #1e40af; margin-bottom: 0.5rem">
          Welcome to TicketFlow! ðŸŽ‰
        </h3>
        <p style="color: #3b82f6">
          You don't have any tickets yet. Create your first ticket to get started.
        </p>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 TicketFlow. All rights reserved.</p>
      <p style="margin-top: 0.5rem; font-size: 0.875rem; opacity: 0.8">
        Built with Twig | Manage tickets with ease
      </p>
    </div>
  </footer>
</div>

<script>
// âœ… Protect page - redirect if not authenticated
protectPage();

// âœ… Load user info
const user = getCurrentUser();
if (user) {
  document.getElementById('username').textContent = user.username;
}

// âœ… Load statistics
const stats = getTicketStats();
document.getElementById('total-tickets').textContent = stats.total;
document.getElementById('open-tickets').textContent = stats.open;
document.getElementById('inprogress-tickets').textContent = stats.inProgress;
document.getElementById('closed-tickets').textContent = stats.closed;

// âœ… Show welcome message if no tickets
if (stats.total === 0) {
  document.getElementById('welcome-message').classList.remove('hidden');
}
</script>
{% endblock %}